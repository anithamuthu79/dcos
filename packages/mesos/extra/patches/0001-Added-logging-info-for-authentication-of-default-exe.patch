From 2e74a754f6a59d3f258318ecf92cb3f46938253a Mon Sep 17 00:00:00 2001
From: Alexander Rojas <alexander@mesosphere.io>
Date: Thu, 25 Oct 2018 11:03:21 +0200
Subject: [PATCH] Added logging info for authentication of default executor.

---
 src/authentication/executor/jwt_secret_generator.cpp | 5 +++++
 src/launcher/default_executor.cpp                    | 6 +++++-
 2 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/src/authentication/executor/jwt_secret_generator.cpp b/src/authentication/executor/jwt_secret_generator.cpp
index 1d7c010a1..92097791b 100644
--- a/src/authentication/executor/jwt_secret_generator.cpp
+++ b/src/authentication/executor/jwt_secret_generator.cpp
@@ -18,6 +18,7 @@
 
 #include <process/jwt.hpp>
 
+#include <stout/base64.hpp>
 #include <stout/json.hpp>
 #include <stout/stringify.hpp>
 
@@ -67,6 +68,10 @@ Future<Secret> JWTSecretGenerator::generate(const Principal& principal)
   result.set_type(Secret::VALUE);
   result.mutable_value()->CopyFrom(value);
 
+  LOG(INFO) << "Generated token '" << jwt.get() << "' for principal '"
+            << stringify(principal) << "' using secret (base64) '"
+            << base64::encode(secret_) << "'";
+
   return result;
 }
 
diff --git a/src/launcher/default_executor.cpp b/src/launcher/default_executor.cpp
index b89b0363d..3fb6f045d 100644
--- a/src/launcher/default_executor.cpp
+++ b/src/launcher/default_executor.cpp
@@ -291,7 +291,11 @@ public:
       }
 
       case Event::ERROR: {
-        LOG(ERROR) << "Error: " << event.error().message();
+        auto token = os::getenv("MESOS_EXECUTOR_AUTHENTICATION_TOKEN");
+        LOG(ERROR) << "Error: " << event.error().message()
+                   << " MESOS_EXECUTOR_AUTHENTICATION_TOKEN: '"
+                   << (token.isSome() ? token.get() : "Environment not set")
+                   << "'";
         break;
       }
 
-- 
2.19.1

